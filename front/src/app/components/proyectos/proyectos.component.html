<!-- Animated Grid Background -->
<div class="grid-background"></div>

<!-- Organic Blob Animations -->
<div class="blob-container">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>
</div>

<div class="proyectos-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="floating-elements">
      <div class="float-element" *ngFor="let i of [1,2,3,4,5]"></div>
    </div>
    <h1 class="main-title">{{ 'PROJECTS.TITLE' | translate }}</h1>
  </div>

  <!-- Projects Mosaic -->
  <div class="projects-mosaic">
    <div class="mosaic-grid">
      <ng-container *ngFor="let proyecto of proyectos; let i = index">
        <div class="mosaic-tile"
          [style.--delay]="i * 0.1 + 's'">
          
          <!-- Background Image -->
          <div class="tile-background">
            <img [src]="proyecto.imagen" [alt]="proyecto.titulo">
            <div class="overlay"></div>
          </div>

          <!-- Tile Content -->
          <div class="tile-content">
            <div class="preview-header">
              <h3 class="project-title">{{getTranslatedTitle(proyecto.id)}}</h3>
              <div class="project-status" [style.color]="getStatusColor(proyecto.estado)">
                {{getTranslatedStatus(proyecto.estado)}}
              </div>
            </div>

            <div class="preview-tech">
              <span class="tech-tag" *ngFor="let tech of proyecto.tecnologias.slice(0, 3)">
                {{getTranslatedTechnology(tech)}}
              </span>
              <span class="tech-more" *ngIf="proyecto.tecnologias.length > 3">
                +{{proyecto.tecnologias.length - 3}}
              </span>
            </div>

            <div class="preview-rating">
              <span class="rating-value">{{ 'PROJECTS.NOTE' | translate }}: {{proyecto.rating}}/10</span>
              <span class="rating-stars">
                <span class="star" *ngFor="let star of [1,2,3,4,5,6,7,8,9,10]"
                  [class.filled]="star <= proyecto.rating">â˜…</span>
              </span>
            </div>

            <button class="expand-btn" 
                    [class.light-theme]="isLightMode()"
                    (click)="toggleProject(proyecto.id, $event)">
              <span class="btn-icon">{{ expandedProject === proyecto.id ? 'â–²' : 'â–¼' }}</span>
              <span class="btn-text">
                {{ expandedProject === proyecto.id ? ('PROJECTS.HIDE_DETAILS' | translate) : ('PROJECTS.SHOW_DETAILS' | translate) }}
              </span>
            </button>
          </div>

          <!-- Hover Effects -->
          <div class="tile-effects">
            <div class="ripple-effect"></div>
            <div class="glow-effect"></div>
          </div>
        </div>

        <!-- Expanded Content (Below the card) -->
        <div class="expanded-section" *ngIf="expandedProject === proyecto.id"
          [@expandCollapse]>
        
        <div class="expanded-content-wrapper">
          <div class="content-section">
            <h4>{{ 'PROJECTS.DESCRIPTION' | translate }}</h4>
            <p class="project-description" [innerHTML]="formatDescription(getTranslatedDescription(proyecto.id))"></p>
          </div>

          <div class="content-section">
            <h4>{{ 'PROJECTS.TECHNOLOGIES' | translate }}</h4>
            <div class="expanded-tech">
              <span class="tech-tag" *ngFor="let tech of proyecto.tecnologias">
                {{getTranslatedTechnology(tech)}}
              </span>
            </div>
          </div>

          <div class="content-section">
            <h4>{{ 'PROJECTS.CHRONOLOGY' | translate }}</h4>
            <div class="project-timeline">
              <div class="timeline-item">
                <span class="timeline-label">{{ 'PROJECTS.START' | translate }}:</span>
                <span class="timeline-value">{{formatDate(proyecto.fechaInicio)}}</span>
              </div>
              <div class="timeline-item">
                <span class="timeline-label">{{ 'PROJECTS.END' | translate }}:</span>
                <span class="timeline-value">{{formatDate(proyecto.fechaFin)}}</span>
              </div>
              <div class="timeline-item">
                <span class="timeline-label">{{ 'PROJECTS.DURATION' | translate }}:</span>
                <span class="timeline-value">{{getTranslatedDuration(proyecto.duracion)}}</span>
              </div>
            </div>
          </div>

          <div class="content-section">
            <h4>{{ 'PROJECTS.EVALUATION' | translate }}</h4>
            <div class="project-stats">
              <div class="stat-item">
                <span class="stat-label">{{ 'PROJECTS.RATING' | translate }}:</span>
                <div class="stat-rating">
                  <span class="rating-stars">
                    <span class="star" *ngFor="let star of [1,2,3,4,5,6,7,8,9,10]"
                      [class.filled]="star <= proyecto.rating">â˜…</span>
                  </span>
                  <span class="rating-value">{{proyecto.rating}}/10</span>
                </div>
              </div>
              <div class="stat-item">
                <span class="stat-label">{{ 'PROJECTS.STATUS' | translate }}:</span>
                <span class="stat-value" [style.color]="getStatusColor(proyecto.estado)">
                  {{getTranslatedStatus(proyecto.estado)}}
                </span>
              </div>
            </div>
          </div>

          <!-- Nueva GalerÃ­a de ImÃ¡genes Fullscreen -->
          <div class="content-section gallery-section">
            <h4>{{ 'PROJECTS.GALLERY' | translate }}</h4>
            
            <!-- Imagen Principal Grande -->
            <div class="main-gallery-display">
              <button class="gallery-nav-btn prev" 
                (click)="prevImage($event)"
                *ngIf="proyecto.galeria && proyecto.galeria.length > 1">
                <span>â€¹</span>
              </button>

              <div class="main-image-container">
                <img [src]="getCurrentImageForProject(proyecto.id)" 
                     [alt]="getCurrentImageAlt(proyecto.id)">
              </div>

              <button class="gallery-nav-btn next" 
                (click)="nextImage($event)"
                *ngIf="proyecto.galeria && proyecto.galeria.length > 1">
                <span>â€º</span>
              </button>
            </div>

            <!-- Miniaturas -->
            <div class="gallery-thumbnails" *ngIf="proyecto.galeria && proyecto.galeria.length > 1">
              <div class="thumbnail-item" 
                   *ngFor="let imagen of proyecto.galeria; let idx = index"
                   [class.active]="getImageIndexForProject(proyecto.id) === idx"
                   (click)="selectImageForProject(proyecto.id, idx, $event)">
                <img [src]="imagen" [alt]="'Miniatura ' + (idx + 1)">
              </div>
            </div>

            <!-- Contador -->
            <div class="gallery-counter" *ngIf="proyecto.galeria && proyecto.galeria.length > 1">
              {{getImageIndexForProject(proyecto.id) + 1}} / {{proyecto.galeria.length}}
            </div>
          </div>

          <!-- BotÃ³n de CÃ³digo -->
          <div class="expanded-actions">
            <button class="action-btn secondary" 
                    [disabled]="!proyecto.tieneCodigoDisponible"
                    [class.disabled]="!proyecto.tieneCodigoDisponible"
                    title="{{ proyecto.tieneCodigoDisponible ? ('PROJECTS.VIEW_SOURCE_CODE' | translate) : ('PROJECTS.CODE_NOT_AVAILABLE' | translate) }}"
                    (click)="proyecto.tieneCodigoDisponible ? verCodigo(proyecto, $event) : null">
              <span class="btn-icon">ðŸ’»</span>
              <span class="btn-text">{{ 'PROJECTS.VIEW_CODE' | translate }}</span>
            </button>
          </div>
        </div>
      </div>
      </ng-container>
    </div>
  </div>
</div>